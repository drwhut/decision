

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Optimisation &mdash; Decision 0.1.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Linking" href="../linking/index.html" />
    <link rel="prev" title="Code Generation" href="code_generation.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Decision
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../the_language/index.html">The Language</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">The Stages of Compilation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="lexical_analysis.html">Lexical Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="syntax_analysis.html">Syntax Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="semantic_analysis.html">Semantic Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="error_reporting.html">Error Reporting</a></li>
<li class="toctree-l2"><a class="reference internal" href="code_generation.html">Code Generation</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Optimisation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#implementation">Implementation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../linking/index.html">Linking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../the_virtual_machine/index.html">The Virtual Machine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Decision</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">The Stages of Compilation</a> &raquo;</li>
        
      <li>Optimisation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/the_stages_of_compilation/optimisation.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="optimisation">
<span id="id1"></span><h1>Optimisation<a class="headerlink" href="#optimisation" title="Permalink to this headline">¶</a></h1>
<p>Optimisation is performed in <code class="docutils literal notranslate"><span class="pre">doptimize.c</span></code> and <code class="docutils literal notranslate"><span class="pre">doptimize.h</span></code>, because I’m
trying to appeal to an American audience, and it totally isn’t the case that
I messed up the spelling the first time round.</p>
<p>The best way to describe Optimisation is like this:
<a class="reference internal" href="code_generation.html#code-generation"><span class="std std-ref">Code Generation</span></a> is very good at creating bytecode - Optimisation is
very good at removing it.</p>
<p>The less instructions in the final bytecode the better. We can reduce the
number of instructions by finding specific situations in the bytecode and
changing it so it is simpler or simply by removing redundant instructions.</p>
<p>Here is a really basic example of optimisation (this should actually be
reduced in the code):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#      Instruction</span>
<span class="mi">41</span> <span class="o">...</span> <span class="n">AND</span> <span class="n">r0</span><span class="p">,</span> <span class="n">r1</span>
<span class="mi">42</span> <span class="o">...</span> <span class="n">NOT</span> <span class="n">r0</span>
<span class="mi">43</span> <span class="o">...</span> <span class="n">NOT</span> <span class="n">r0</span>
<span class="mi">44</span> <span class="o">...</span> <span class="n">JRCON</span> <span class="n">r0</span><span class="p">,</span> <span class="mh">0x43</span>
</pre></div>
</div>
<p>There is no point in those 2 NOT instructions being there, they cancel each
other out!</p>
<div class="section" id="implementation">
<h2>Implementation<a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h2>
<p>Each “situation” like the example above is in its own function in
<code class="docutils literal notranslate"><span class="pre">doptimize.h</span></code>. Theese functions take in a <code class="docutils literal notranslate"><span class="pre">Sheet</span></code> and find their
situations in the code, and reduces the bytecode using a helper function:</p>
<dl class="function">
<dt>
void <code class="sig-name descname">d_optimize_remove_bytecode</code><span class="sig-paren">(</span><em class="property">struct</em> <a class="reference internal" href="../reference/index.html#_CPPv46_sheet" title="_sheet">_sheet</a> *<em>sheet</em>, size_t <em>start</em>, size_t <em>len</em><span class="sig-paren">)</span><br /></dt>
<dd><p>Remove a section of bytecode, and make any adjustments to the data that is nessesary. </p>
<p><dl class="simple">
<dt><strong>Parameters</strong></dt><dd><ul class="breatheparameterlist simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sheet</span></code>: The sheet containing the bytecode to remove from. </p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">start</span></code>: The starting index of the bytecode to remove. </p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">len</span></code>: How many bytes to remove, starting from <code class="docutils literal notranslate"><span class="pre">start</span></code>. </p></li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<p>Which removes <code class="docutils literal notranslate"><span class="pre">len</span></code> instructions from the <code class="docutils literal notranslate"><span class="pre">.text</span></code> section of <code class="docutils literal notranslate"><span class="pre">sheet</span></code>,
starting from the index <code class="docutils literal notranslate"><span class="pre">start</span></code>.</p>
<p>The individual functions also return a boolean to say if they found a way to
optimise the bytecode (i,e, they return <code class="docutils literal notranslate"><span class="pre">true</span></code> if they changed the
bytecode). This way, you can check for new situations that crop up when
bytecode is removed, but only if bytecode was removed.</p>
<p>All of the optimisations are attempted in one big helper function:</p>
<dl class="function">
<dt>
void <code class="sig-name descname">d_optimize_all</code><span class="sig-paren">(</span><em class="property">struct</em> <a class="reference internal" href="../reference/index.html#_CPPv46_sheet" title="_sheet">_sheet</a> *<em>sheet</em><span class="sig-paren">)</span><br /></dt>
<dd><p>Try and optimise all possible senarios. </p>
<p><dl class="simple">
<dt><strong>Parameters</strong></dt><dd><ul class="breatheparameterlist simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sheet</span></code>: The sheet containing the bytecode to optimise. </p></li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../linking/index.html" class="btn btn-neutral float-right" title="Linking" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="code_generation.html" class="btn btn-neutral float-left" title="Code Generation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Benjamin Beddows

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>